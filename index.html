<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.54.0/dist/phaser.js"></script>
</head>

<body class="min-vh-100 min-vw-100 d-flex justify-content-center align-items-center bg-secondary">
    <nav class="navbar fixed-top navbar-expand-sm navbar-dark bg-dark">
        <div class="container-fluid">
            <div class="d-flex justify-content-end w-100">
                <h2 class="navbar-brand"><img src="assets/dollar.png" alt="coin" width="64" height="64"> 0</h2>
            </div>
        </div>
    </nav>
    <nav class="navbar fixed-bottom navbar-expand-sm navbar-dark bg-dark">
        <div class="container-fluid">
            <div class="d-flex justify-content-between w-100">
                <buttom class="btn btn-success" id="1"><img src="assets/plant.png" alt="" width="64" height="64">
                </buttom>
                <buttom class="btn btn-success"><img src="assets/watering-can.png" alt="" width="64" height="64">
                </buttom>
                <buttom class="btn btn-success"><img src="assets/scythe.png" alt="" width="64" height="64"></buttom>
            </div>
        </div>
    </nav>
    <div>
        <script src="js/phaser.min.js"></script>
        <script src="js/phaser-plugin-isometric.min.js"></script>
        <script>
            //CONFIG
            var game = new Phaser.Game(1080, 720, Phaser.AUTO, 'test', null, true, false);
            var BasicGame = function (game) { };
            BasicGame.Boot = function (game) { };
            var isoGroup, cursorPos, cursor;

            //VARIABLES
            var map = [
                [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0],
                [2, 1, 1, 3, 2, 3, 1, 1, 2, 1, 1, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0],
                [2, 1, 1, 3, 2, 3, 1, 1, 2, 1, 3, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0],
                [2, 1, 1, 3, 2, 3, 1, 1, 2, 1, 1, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0],
                [2, 1, 1, 3, 2, 3, 1, 1, 2, 1, 1, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0],
                [2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 1],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
            ];

            const size = 35.8;
            const speed = 100;

            BasicGame.Boot.prototype =
            {
                //--------------------------------------------------------------------------------
                preload: function () {
                    //LOAD IMAGES
                    game.load.image('grass', 'assets/grass.png');
                    game.load.image('nograss', 'assets/nograss.png');
                    game.load.image('character', 'assets/character.png');
                    game.load.image('tree', 'assets/tree.png');
                    game.load.image('wheat', 'assets/wheat.png');

                    //SET UP GAME
                    game.time.advancedTiming = true;
                    game.plugins.add(new Phaser.Plugin.Isometric(game));
                    game.world.setBounds(0, 0, 1496, 1024);
                    game.physics.startSystem(Phaser.Plugin.Isometric.ISOARCADE);
                    game.iso.anchor.setTo(0.5, 0.0);
                },
                //--------------------------------------------------------------------------------
                create: function () {
                    //GRAVITY
                    game.physics.isoArcade.gravity.setTo(0, 0, -1000);

                    //SPAWN
                    this.spawnTiles();
                    isoGroup = game.add.group();
                    this.spawnTilesSecond();

                    //CHARACTER
                    player = game.add.isoSprite(size * 10, size * 10, 0, 'character', 0, isoGroup);
                    player.anchor.set(0.5);
                    game.physics.isoArcade.enable(player);
                    player.body.collideWorldBounds = true;

                    //ADD KEY TO MOVE
                    this.cursors = game.input.keyboard.createCursorKeys();
                    this.game.input.keyboard.addKeyCapture([
                        Phaser.Keyboard.LEFT,
                        Phaser.Keyboard.RIGHT,
                        Phaser.Keyboard.UP,
                        Phaser.Keyboard.DOWN,
                        Phaser.Keyboard.SPACEBAR
                    ]);

                    //CAMERA MOVE
                    game.camera.follow(player);

                },
                //--------------------------------------------------------------------------------
                update: function () {
                    //MOVE UPDATE
                    player.body.velocity.y = (this.cursors.up.isDown ? -speed : (this.cursors.down.isDown ? speed : 0));
                    player.body.velocity.x = (this.cursors.left.isDown ? -speed : (this.cursors.right.isDown ? speed : 0));
                    
                    game.physics.isoArcade.collide(isoGroup);
                    game.iso.topologicalSort(isoGroup);
                },
                //--------------------------------------------------------------------------------
                spawnTiles: function () {
                    for (var xx = 0; xx < map[0].length * size - size; xx += size) {
                        for (var yy = 0; yy < map.length * size - size; yy += size) {
                            if ((map[parseInt(xx / size)][parseInt(yy / size)] == 0) || (map[parseInt(xx / size)][parseInt(yy / size)] == 2)) {
                                //GRASS
                                grass = game.add.isoSprite(xx, yy, 0, 'grass', 0, isoGroup);
                                grass.anchor.set(0.5, 0);
                            } else if (map[parseInt(xx / size)][parseInt(yy / size)] == 1 || (map[parseInt(xx / size)][parseInt(yy / size)] == 3)) {
                                //NOGRASS
                                nograss = game.add.isoSprite(xx, yy, 0, 'nograss', 0, isoGroup);
                                nograss.anchor.set(0.5, 0);
                            }
                        }
                    }
                },
                //--------------------------------------------------------------------------------
                spawnTilesSecond: function () {
                    for (var xx = 0; xx < map[0].length * size; xx += size) {
                        for (var yy = 0; yy < map.length * size; yy += size) {
                            if (map[parseInt(xx / size)][parseInt(yy / size)] == 2) {
                                //TREE
                                tree = game.add.isoSprite(xx, yy, 0, 'tree', 0, isoGroup);
                                tree.anchor.set(0.5);
                                game.physics.isoArcade.enable(tree);
                                tree.body.collideWorldBounds = true;
                                tree.body.immovable = true;
                            } else if (map[parseInt(xx / size)][parseInt(yy / size)] == 3) {
                                //WHEAT
                                wheat = game.add.isoSprite(xx, yy, 0, 'wheat', 0, isoGroup);
                                wheat.anchor.set(0.5);
                            }
                        }
                    }
                },
                //--------------------------------------------------------------------------------
                render: function () {
                    game.debug.text(game.time.fps || '--', 2, 14, "#a7aebe");
                },
            };

            //CONFIG
            game.state.add('Boot', BasicGame.Boot);
            game.state.start('Boot');
        </script>
    </div>

</body>

</html>
<!--
    todo:
    prszyciski ekranowe do navigacji
    lista zadaÅ„
    mapa
    przedmioty
    interfejs podlewanie sadzenie
    https://www.flaticon.com/search?word=watering%20can
    https://www.flaticon.com/search?word=scythe
    https://www.flaticon.com/search?word=coin
    https://www.flaticon.com/search?word=plant
-->